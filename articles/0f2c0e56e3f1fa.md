---
title: "serdeã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ã‚¢ãƒ©ã‚¤ã‚ºå®Ÿä¾‹"
emoji: "ğŸ“„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["rust", "json", "serde"]
published: true
---

## èª¬æ˜

ä»¥ä¸‹äºŒã¤ã®æ§‹é€ ä½“ã‚’serdeã§jsonã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã¨ã©ã†ãªã‚‹ã®ã‹ã®å®Ÿä¾‹ã§ã™ã€‚ä¸Šã‚’Simple, ä¸‹ã‚’Complexã¨ã—ã¦ã¾ã™ã€‚

```rust
Self {
    int_field: 1,
    float_field: 2.3,
    str_field: "foo".to_string(),
    boolean_field: false,
}
Self {
    desc: "it is complex".to_string(),
    simple_1: Simple::default(), // Simpleã¯ä¸Šã®æ§‹é€ ä½“
    date: Local::now(),
}
```

å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã¯ğŸ‘‡ã€‚Cargo.tomlã§`serde`ã¯`derive`featureã®å…¥ã‚Œå¿˜ã‚Œã«æ³¨æ„ã€‚& chronoã‚’ä½¿ã†å ´åˆã¯featureã«`serde`ã‚’å…¥ã‚Œãªã„ã¨ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

https://github.com/Uliboooo/eg_serde/blob/main/Cargo.toml
https://github.com/Uliboooo/eg_serde/blob/main/src/main.rs

## æ§‹é€ ä½“ã‚’æ–‡å­—åˆ—ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º

Simpleã‚’`serde_json::to_string_pretty(&simple).unwrap()`ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ãŸä¾‹ã€‚to_string_prettyã®å¼•æ•°ã¯å‚ç…§ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã¾ãŸã€`to_string_pretty()`ã¯æ”¹è¡Œãªã©ã‚’å«ã‚€äººé–“å‘ã‘ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã€`to_string()`ãªã‚‰1è¡Œã«å…¨ã¦å…¥ã‚ŒãŸã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€‚

```json
{
  // Simple structure
  "int_field": 1,
  "float_field": 2.3,
  "str_field": "foo",
  "boolean_field": false
}
```

```json
{
  // complex structure
  "desc": "it is complex",
  "simple_1": {
    "int_field": 1,
    "float_field": 2.3,
    "str_field": "foo",
    "boolean_field": false
  },
  "date": "2025-06-09T14:12:07.039653+09:00"
}
```

`to_string()`ã§1è¡Œã«ã—ãŸå ´åˆã€‚complexã‚’1è¡Œã«ã€‚

```rust
println!("{}", serde_json::to_string(&complex).unwrap());
```

```json
{"desc":"it is complex","simple_1":{"int_field":1,"float_field":2.3,"str_field":"foo","boolean_field":false},"date":"2025-06-09T14:51:53.342622+09:00"}
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜å¾Œã«ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦èª­ã‚€

ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦èª­ã¿è¾¼ã‚“ã§ã€Debugã§è¡¨ç¤ºã—ãŸã®ã§ã™ãŒåŸºæœ¬çš„ã«ã¯å¤‰ã‚ã‚‰ãªã„? ãƒ‡ã‚·ã‚¢ãƒ©ã‚¤ã‚ºã§ã¯å‹æ³¨é‡ˆãŒå¿…è¦ã€‚æŸç¸›å…ˆã®å¤‰æ•°ã®å‹æ³¨é‡ˆã‹ã‚¿ãƒ¼ãƒœãƒ•ã‚£ãƒƒã‚·ãƒ¥ã§å‹ã‚’æŒ‡å®šã™ã‚‹ã€‚å€‹äººçš„ã«ã¯æ™®é€šã®å¤‰æ•°ã§ã¯å‹æ³¨é‡ˆã‚’æ›¸ã‹ãªã„ã®ã§ã€ãã‚Œã«åˆã‚ã›ã¦é–¢æ•°å‹ã«å‹ã‚’æ›¸ããŸã„æ´¾ã€‚

```rust
// ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
let loaded_simple_f = fs::read_to_string(&simple_path).unwrap();
// `from_str::<Simple>()`ã§ã‚¿ãƒ¼ãƒœãƒ•ã‚£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã£ã¦ã€serde_jsonãŒä½•ã«ãƒ‡ã‚·ã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã‹ã‚’ç¤ºã™ã€‚
let simple_deserialized = serde_json::from_str::<Simple>(&loaded_simple_f).unwrap();
```

```rust
Simple { int_field: 1, float_field: 2.3, str_field: "foo", boolean_field: false }
```

```rust
Comlex { desc: "it is complex", simple_1: Simple { int_field: 1, float_field: 2.3, str_field: "foo", boolean_field: false }, date: 2025-06-09T14:42:35.282669+09:00 }
```

ãƒã‚¯ãƒ­ã§ã“ã“ã¾ã§ä¾¿åˆ©ã«æ›¸ã‘ã‚‹ã®ã¯ã„ã„ã§ã™ã­
