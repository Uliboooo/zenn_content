---
title: "Rustã§ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œã®ã‚ˆã†ãªå½¢ã§å¤‰æ•°ã‚’æŸç¸›ã™ã‚‹ã€dynã€‘"
emoji: "ğŸ§®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["rust", "dyn", "å‹"]
published: true
---

å½“ç„¶ã§ã™ãŒã€Rustã¯åŸºæœ¬çš„ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å¤‰æ•°ã«æŸç¸›ã™ã‚‹å€¤ã®å‹ã‚’åˆ¤æ˜ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€å ´åˆã«ã‚ˆã£ã¦ã¯å®Ÿè¡Œæ™‚ã«å‹ã‚’æ±ºå®šã—ãŸã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

## ä¾‹code

ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã§å„llmã‚’é¸ã‚“ã§ä½¿ã†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚

```rust: main.rs
trait Responder {
    fn respond(&self) -> Result<String, std::io::Error>;
}

struct OpenAI {
    model: String,
}

impl OpenAI {
    fn new(model: &str) -> Self {
        Self {
            model: model.to_string(),
        }
    }
}

impl Responder for OpenAI {
    fn respond(&self) -> Result<String, std::io::Error> {
        Ok(String::from("I'm a chatGPT."))
    }
}

struct Google {
    model: String,
}

impl Google {
    fn new(model: &str) -> Self {
        Self {
            model: model.to_string(),
        }
    }
}

impl Responder for Google {
    fn respond(&self) -> Result<String, std::io::Error> {
        Ok(String::from("I'm a gemini."))
    }
}

fn main() {
    let selected_model = "openai";
    let model = if selected_model == "openai" {
        OpenAI::new("chatgpt")
    } else {
        Google::new("gemini")
    };
}
```

ã—ã‹ã—ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ifã§trueã¨falseã®å ´åˆã§é•ã†å‹(`OpenAI`ã¨`Google`)ãŒè¿”ã‚‹ãŸã‚ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã¾ã™ã€‚

```rust
cargo check
    Checking dyn_trait v0.1.0 (~/Develop/for_zenn/dyn_trait)
error[E0308]: `if` and `else` have incompatible types
  --> src/main.rs:46:9
   |
43 |       let model = if selected_model == "openai" {
   |  _________________-
44 | |         OpenAI::new("chatgpt")
   | |         ---------------------- expected because of this
45 | |     } else {
46 | |         Google::new("gemini")
   | |         ^^^^^^^^^^^^^^^^^^^^^ expected `OpenAI`, found `Google`
47 | |     };
   | |_____- `if` and `else` have incompatible types

For more information about this error, try `rustc --explain E0308`.
error: could not compile `dyn_trait` (bin "dyn_trait") due to 1 previous error
```

ã“ã“ã§`dyn`ã‚’ä½¿ã£ã¦å¤‰æ•°ã‚’`Responder trait`ã‚’å®Ÿè£…ã—ãŸå‹ã¨åˆ¶é™ã‚’ã¤ã‘ã¦å®šç¾©ã™ã‚‹ã¨å®Ÿè¡Œæ™‚ã«å‹ã‚’æ±ºå®šã§ãã¾ã™ã€‚
ã¾ãŸã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å€¤ã®ã‚µã‚¤ã‚ºãŒä¸æ˜ãªã®ã§Boxã§å›²ã¿ã¾ã™ã€‚ä½¿ã„æ–¹çš„ã«ã¯é–¢æ•°ã®ã‚¸ã‚§ãƒãƒªãƒƒã‚¯å‹`T`ã«è¿‘ã„ã¨æ€ã†ã€‚

```rust: main.rs main()
fn main() {
    let selected_model = "openai";
    let model: Box<dyn Responder> = if selected_model == "openai" {
        Box::new(OpenAI::new("chatgpt"))
    } else {
        Box::new(Google::new("gemini"))
    };
}
```

ã¡ãªã¿ã«ã“ã†ã™ã‚Œã°è¡¨ç¤ºã¾ã§ã§ãã¾ã™ã€‚ifã§"openai"ã«å›ºå®šã—ã¦ã„ã‚‹ã®ã§æ™®é€šã«`I'm a chatGPT.`ã¨è¡¨ç¤ºã•ã‚Œã¦çµ‚ã‚ã‚Šã§ã™ãŒã€‚

```rust
fn main() {
    let selected_model = "openai";
    let model: Box<dyn Responder> = if selected_model == "openai" {
        Box::new(OpenAI::new("chatgpt"))
    } else {
        Box::new(Google::new("gemini"))
    };
    println!("{}", model.respond().unwrap());
}
```

## å‚è€ƒ

https://doc.rust-jp.rs/rust-by-example-ja/trait/dyn.html
